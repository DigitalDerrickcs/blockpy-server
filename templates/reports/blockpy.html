<h2 id='{{ assignment.slug() }}'>{{ assignment.name }}</h2>

{% if is_grader %}
    {% if assignment.reviewed %}
        {% if not session['is_lti_active'] or g.course.id != submission.course_id %}
            <div class="alert alert-warning" role="alert">
                You are not in an LTI session for this course. Launch an LTI session by opening
                the dashboard.
            </div>
        {% endif %}
        <script>
            $(document).ready(function() {
                $("#assign-grade").click(function() {
                    let grade = $("#grade-value").val();
                    let correct = $("#correct-value").is(":checked");
                    let failButton = function(reason) {
                            $("#assign-grade").text("Failed to assign!")
                                .removeClass("btn-success").addClass("btn-danger");
                            console.error(reason);
                        };
                    submitGrade({{ submission.id }}, {{ submission.course_id }}, grade, correct)
                        .done(function(response) {
                            if (response.success) {
                                $("#assign-grade").text("Assigned!")
                                .removeClass("btn-success btn-danger").addClass("btn-success");
                            } else {
                                failButton(response.message);
                            }
                        }).fail(failButton);
                })
                $("#correct-value").on('change keyup input', function() {
                    let correct = $("#correct-value").is(":checked");
                    console.log(correct);
                    $("#grade-value").prop("disabled", correct);
                    if (correct) {
                        $("#grade-value").val("100");
                    } else {
                        $("#grade-value").val("0");
                    }
                });
            });
        </script>
        <div>
        <form>
            <label>Is Correct?: <input type="checkbox" id="correct-value"
            {% if submission.correct %}checked{% endif %}></label> or
            <label>Grade: <input type="text" id="grade-value" value="{{ submission.score }}">/100</label><br>
            <button class='btn btn-success' id="assign-grade" type="button">Assign Grade</button>
        </form>
        </div>
    {% endif %}
{% endif %}

<div>Status: {{ submission.full_status() }}</div>
<!-- TODO: Use the LTI information to build the proper URL
<div>Open in Canvas: <a href='' target='_blank'>View</a></div>
<div>Instructor Link: <a href='' target='_blank'>View</a></div>
-->
<div>Touches: {{ submission.version }}</div>
<div>History: <a href="{{ url_for('blockpy.browse_history', assignment_id=submission.assignment_id,
        user_id=submission.user_id, course_id=submission.course_id) }}">view</a></div>
<div>Estimated Duration: {{ (submission.version/60.0)|round(2) }} minutes</div>
{% set turtle_output = submission.get_image('turtle_output') %}
{% if turtle_output %}
    <div>Turtle Output: <br>
        <img alt='Image of Turtle Output' src='{{ turtle_output }}'>
    </div>
{% endif %}
{% set image = submission.get_block_image() %}
{% if image %}
    <div>Submitted Blocks: <br>
        <img alt='Block version of code' src='{{ image }}'>
    </div>
{% endif %}
<div>Submitted code:<br>
    {{ submission.code|highlight_python_code|safe }}
    {% if submission.extra_files %}
        {% for filename, contents in submission.extra_files|json_load %}
            <strong>{{ filename }}</strong>
            {{ contents|highlight_python_code|safe }}
        {% endfor %}
    {% endif %}
</div>

{% if is_grader %}
    <div><small>

        Assignment: {{ submission.assignment_id }},
        User: {{ submission.user_id }},
        Course: {{ submission.course_id }}

    </small></div>

{% endif %}
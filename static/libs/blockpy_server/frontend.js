var frontend;frontend=(()=>{"use strict";var e={154:(e,t,s)=>{s.r(t),s.d(t,{Assignment:()=>p,AssignmentGroup:()=>r,GroupList:()=>d,User:()=>u,Watcher:()=>S});const n=ko,a=CodeMirror;n.bindingHandlers.codemirror={init:function(e,t){let s=n.unwrap(t());e.editor=a(e,n.toJS(s)),e.editor.on("change",(function(e){s.value(e.getValue())})),n.utils.domNodeDisposal.addDisposeCallback(e,(function(){let t=e.editor.getWrapperElement();t.parentNode.removeChild(t)}))},update:function(e,t){let s=n.toJS(t()).value;if(e.editor){let t=e.editor.getCursor();e.editor.setValue(s),e.editor.setCursor(t),e.editor.refresh()}}};class i{constructor(e){this.map=new Map,this.lefts=[],this.rights=[];for(let t in e)this.lefts.push(t),this.rights.push(e[t]),this.map.set(t,e[t]),this.map.set(e[t],t)}get(e){return this.map.get(e)}}class r{constructor(e){this.id=e.id,this.name=n.observable(e.name)}}function o(e,t){return $.get(window.$URL_ROOT+e,t)}n.components.register("assignment-group",{viewModel:r,template:'\n    <div>Assignment Group: <span data-bind="text: name()"></span></div>\n'});class d{constructor(){this.groups=n.observableArray([]),$().ready((()=>this.load()))}load(){o("get/",{course_id:3}).then((e=>{this.groups(e.groups.map((e=>new r(e))))}))}}n.components.register("group-list",{viewModel:d,template:'\n    <div>Groups:\n        <div data-bind="foreach: groups">\n            <div data-bind="component: {name: \'assignment-group\', params: $data}"></assignment-group>\n        </div>\n    </div>\n'});class l{constructor(e){this.FIELDS=new i({date_modified:"dateModified",date_created:"dateCreated"}),this.id=e.id,this.dateModified=n.observable(e.date_modified),this.dateCreated=n.observable(e.date_created)}fromJson(e){this.FIELDS.lefts.forEach((t=>{this[this.FIELDS.get(t)](e[t])}))}koFromJson(e){this.FIELDS.lefts.forEach((t=>{this[this.FIELDS.get(t)]=n.observable(e[t])}))}toJson(){let e={id:this.id};return this.FIELDS.rights.forEach((t=>e[this.FIELDS.get(t)]=this[t]())),e}}class c{constructor(e){this.data={},this.courseId=e,this.delayedData=[],this.timer=null}getInstance(e){if(void 0!==this.data[e])return this.data[e];{let t=this.makeEmptyInstance(e);return this.delayLoadInstance(t),this.data[e]=t,t}}delayLoadInstance(e){clearTimeout(this.timer),this.delayedData.push(e),this.queueFinishDelay()}queueFinishDelay(){this.delayedData.length>25?this.finishDelayedLoads():this.delayedData.length>0&&(this.timer=window.setTimeout(this.finishDelayedLoads.bind(this),1e3))}getInstances(e){return e.map(this.getInstance.bind(this))}finishDelayedLoads(){return this.getPayload(),this.getUrl(),o(this.getUrl(),this.getPayload()).then((e=>{if(e.success){let t=e[this.GET_FIELD].map((e=>(this.data[e.id].fromJson(e),e.id)));this.removeDelayedInstances(t)}else console.error(e)}))}getDelayedIds(){return this.delayedData.map((e=>e.id))}removeDelayedInstances(e){this.delayedData=this.delayedData.filter((t=>!e.includes(t.id))),this.queueFinishDelay()}}class h extends l{constructor(e){super(e),this.FIELDS=new i({user_id:"userId",course_id:"courseId",name:"name"}),this.koFromJson(e)}}class u extends l{constructor(e){super(e),this.FIELDS=new i({email:"email",first_name:"firstName",last_name:"lastName"}),this.koFromJson(e),this.name=n.pureComputed((()=>this.firstName()+" "+this.lastName()),this),this.primaryRole=n.pureComputed((()=>this.roles().length?this.roles().map((e=>{return"string"!=typeof(t=e.name().replace("urn:lti:role:ims/lis/",""))?"":t.charAt(0).toUpperCase()+t.slice(1);var t})).join("/"):"User"),this)}koFromJson(e){super.koFromJson(e);let t=[];e.roles&&(t=e.roles.map((e=>new h(e)))),this.roles=n.observableArray(t)}fromJson(e){super.fromJson(e),this.roles.removeAll(),e.roles&&e.roles.forEach((e=>this.roles.push(new h(e))))}toJson(){let e=super.toJson();return e.roles=this.roles().map((e=>e.toJson())),e}}class m extends c{constructor(){super(...arguments),this.GET_FIELD="users"}getPayload(){return{user_ids:this.getDelayedIds().join(","),course_id:this.courseId}}getUrl(){return"courses/users"}makeEmptyInstance(e){return new u({id:e,email:"",date_created:null,date_modified:null,first_name:"",last_name:"Unknown"})}}n.components.register("user",{viewModel:u,template:'\n    <div>User: <span data-bind="text: name"></span></div>\n'}),n.components.register("user-short",{template:'\n    <div><span data-bind="text: primaryRole"></span>: <span data-bind="text: name"></span> (<span data-bind="text: email"></span>)</div>\n'});class p extends l{constructor(e){super(e),this.FIELDS=new i({name:"name",url:"url",type:"type",instructions:"instructions",reviewed:"reviewed",hidden:"hidden",public:"public",ip_ranges:"ipRanges",settings:"settings",on_run:"onRun",on_change:"onChange",on_eval:"onEval",starting_code:"startingCode",extra_instructor_files:"extraInstructorFiles",extra_starting_files:"extraStartingFiles",forked_id:"forkedId",forked_version:"forkedVersion",owner_id:"ownerId",course_id:"courseId",version:"version"}),this.koFromJson(e)}}class g extends c{constructor(){super(...arguments),this.GET_FIELD="assignments"}getPayload(){return{assignment_ids:this.getDelayedIds().join(","),course_id:this.courseId}}getUrl(){return"assignments/get_ids"}makeEmptyInstance(e){return new p({id:e,date_created:null,date_modified:null,name:"Unknown",url:"",type:"unknown",instructions:"",reviewed:!1,hidden:!1,public:!1,ip_ranges:"",settings:"",on_run:"",on_change:"",on_eval:"",starting_code:"",extra_instructor_files:"",extra_starting_files:"",forked_id:0,forked_version:0,owner_id:0,course_id:0,version:0})}}n.components.register("assignment",{viewModel:p,template:'\n    <div>Assignment: <span data-bind="text: name"></span></div>\n'}),n.components.register("assignment-short",{template:'\n    <div>Assignment: <span data-bind="text: name"></span> (<span data-bind="text: url"></span>)</div>\n'});class b extends l{constructor(e){super(e),this.FIELDS=new i({date_modified:"dateModified",date_created:"dateCreated",assignment_id:"assignmentId",assignment_version:"assignmentVersion",course_id:"courseId",subject_id:"subjectId",event_type:"eventType",file_path:"filePath",category:"category",label:"label",message:"message",client_timestamp:"clientTimestamp",client_timezone:"clientTimezone"}),this.koFromJson(e)}getAsSubmissionKey(){return[this.courseId(),this.subjectId(),this.assignmentId()].join(",")}isEditEvent(){return"File.Edit"===this.eventType()||"File.Create"===this.eventType()}}const v={"Session.Start":"Began session","X-IP.Change":"Changed IP address","File.Edit":"Edited code","File.Create":"Started assignment","Run.Program":"Ran program","Compile.Error":"Syntax error","X-Submission.LMS":"Updated grade"},y=["Jan","Feb","Mar","Apr","May","June","July","Aug","Sept","Oct","Nov","Dec"],f=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var I,E;!function(e){e[e.FROZEN_LATEST=0]="FROZEN_LATEST",e[e.POLL=1]="POLL",e[e.REVIEW=2]="REVIEW"}(I||(I={}));class _{constructor(e,t,s){this.code=n.observable(""),this.logs=n.observableArray([]),this.user=t,this.assignment=s,this.watchMode=n.observable(I.FROZEN_LATEST),this.isVcrActive=n.pureComputed((()=>this.watchMode()===I.REVIEW),this),this.getWatchModeClass=n.pureComputed((()=>{switch(this.watchMode()){case I.FROZEN_LATEST:return"fa-pause-circle";case I.POLL:return"fa-eye";case I.REVIEW:return"fa-history"}}),this)}addLog(e){this.logs.push(e),"File.Create"!==e.eventType()&&"File.Edit"!==e.eventType()||this.code(e.message())}loadHistorySelector(e){let t=this.getSelector(e),s=0,n=null;this.logs().forEach(((e,a)=>{let i=function(e){if(void 0===e)return"Undefined Time";let t=new Date,s=new Date(parseInt(e,10));if(a=s,(n=t).getDate()===a.getDate()&&n.getMonth()===a.getMonth()&&n.getFullYear()===a.getFullYear())return"Today";var n,a;{let e=f[s.getDay()]+", "+y[s.getMonth()]+" "+s.getDate();return t.getFullYear()===s.getFullYear()?e:e+", "+s.getFullYear()}}(e.clientTimestamp());null!==n&&n.attr("label")==i||(n=$("<optgroup></optgroup>"),n.attr("label",i),t.append(n));let r=v[e.eventType()]||e.eventType(),o=(void 0===(d=e.clientTimestamp())?"Undefined Time":new Date(parseInt(d,10)).toLocaleTimeString())+" - "+r;var d;let l=$("<option></option>",{text:o});l.attr("value",s),s+=1,n.append(l)})),t.val(Math.max(0,s-1)),t.on("change",(e=>{this.viewLog(e)}))}viewLog(e){let t=parseInt(this.getSelector(e).val(),10),s=this.logs()[t];s.isEditEvent()&&this.code(s.message())}switchWatchMode(e,t){switch(this.watchMode()){case I.FROZEN_LATEST:this.watchMode(I.POLL);break;case I.POLL:this.loadHistorySelector(t),this.watchMode(I.REVIEW);break;case I.REVIEW:this.watchMode(I.FROZEN_LATEST)}}getSelector(e){return $(e.target).closest("div").find(".history-select")}moveToMostRecent(e,t){this.getSelector(t).val(this.logs().length-1),this.viewLog(t)}moveToBack(e,t){let s=parseInt(this.getSelector(t).val(),10);this.getSelector(t).val(Math.max(0,s-1)),this.viewLog(t)}seekToBack(e,t){let s,n=parseInt(this.getSelector(t).val(),10);do{n-=1,s=this.logs()[n]}while(n>0&&!s.isEditEvent());this.getSelector(t).val(Math.max(0,n)),this.viewLog(t)}moveToNext(e,t){let s=parseInt(this.getSelector(t).val(),10);this.getSelector(t).val(Math.min(this.logs().length-1,s+1)),this.viewLog(t)}seekToNext(e,t){let s,n=parseInt(this.getSelector(t).val(),10);do{n+=1,s=this.logs()[n]}while(n<this.logs().length-1&&!s.isEditEvent());this.getSelector(t).val(Math.min(this.logs().length-1,n)),this.viewLog(t)}moveToStart(e,t){this.getSelector(t).val(0),this.viewLog(t)}}n.components.register("submission-history-card",{template:'\n<div class="card">\n    <span>Started, Edited, Ran, Completed</span>\n    <span data-bind="component: {name: \'user-short\', params: user}"></span>\n    <span data-bind="component: {name: \'assignment-short\', params: assignment}"></span>\n    <div data-bind="codemirror: {\n        mode: \'python\',\n        value: code,\n        lineNumbers: true,\n        readOnly: true\n    }"></div>\n</div>\n'}),n.components.register("submission-history-vcr",{template:'\n<div class="col-md-12" data-bind="visible: $parent.isVcrActive()">\n    <form class="form-inline">\n        <button class="btn btn-outline-secondary mr-2 btn-sm" type="button"\n            data-bind="click: $parent.moveToStart.bind($parent)">\n            <span class=\'fas fa-step-backward\'></span> Start\n        </button>\n        <button class="btn btn-outline-secondary mr-2 btn-sm" type="button"\n            data-bind="click: $parent.seekToBack.bind($parent)">\n            <span class=\'fas fa-fast-backward\'></span>\n        </button>\n        <button class="btn btn-outline-secondary mr-2 btn-sm" type="button"\n            data-bind="click: $parent.moveToBack.bind($parent)">\n            <span class=\'fas fa-backward\'></span> Back\n        </button>\n        <select class="history-select form-control custom-select mr-2 custom-select-sm" aria-title="History Selector">\n        </select>\n        <button class="btn btn-outline-secondary mr-2 btn-sm" type="button"\n            data-bind="click: $parent.moveToNext.bind($parent)">\n            <span class=\'fas fa-forward\'></span> Next\n        </button>\n        <button class="btn btn-outline-secondary mr-2 btn-sm" type="button"\n            data-bind="click: $parent.seekToNext.bind($parent)">\n            <span class=\'fas fa-fast-forward\'></span>\n        </button>\n        <button class="btn btn-outline-secondary btn-sm" type="button"\n            data-bind="click: $parent.moveToMostRecent.bind($parent)">\n            <span class=\'fas fa-step-forward\'></span> Most Recent\n        </button>\n    </form>\n</div>\n'}),function(e){e[e.NONE=0]="NONE",e[e.ASSIGNMENT=1]="ASSIGNMENT",e[e.USER=2]="USER"}(E||(E={}));class S{constructor(e){this.courseId=n.observable(e.courseId),this.assignmentIds=n.observableArray(e.assignmentIds),this.userIds=n.observableArray(e.userIds),this.grouping=n.observable(E.NONE),this.logs=n.observableArray([]),this.submissions=n.observableArray([]),this.cauToSubmission={},this.userStore=new m(e.courseId[0]),this.assignmentStore=new g(e.courseId[0]),$(this.getLatest.bind(this))}addLog(e){this.logs.push(e);let t=e.getAsSubmissionKey(),s=this.cauToSubmission[t];if(void 0===s){let n=this.userStore.getInstance(e.subjectId()),a=this.assignmentStore.getInstance(e.assignmentId());s=this.cauToSubmission[t]=new _(e,n,a),this.submissions.push(s)}s.addLog(e)}addLogs(e){let t=[...new Set(e.map((e=>e.subject_id)))];this.userStore.getInstances(t),e.forEach((e=>this.addLog(new b(e))))}getLatest(){o("blockpy/load_history",{assignment_id:this.assignmentIds()[0],course_id:this.courseId(),user_id:this.userIds()[0]}).then((e=>{e.success?this.addLogs(e.history):console.error(e)}))}}n.components.register("watcher",{viewModel:S,template:'\n    <div>\n        <div data-bind="foreach: submissions">\n            <button class="btn btn-outline-secondary mr-2 btn-sm" type="button"\n                data-bind="click: switchWatchMode">\n                <span class=\'fas\' data-bind="class: getWatchModeClass"></span>\n            </button>\n            <submission-history-vcr></submission-history-vcr>\n            <submission-history-card params="code: code, user: user, assignment: assignment"></submission-history-card>\n        </div>\n        <div data-bind="foreach: logs">\n            <span style=\'border: 1px solid black;\' data-bind="text: eventType"></span>\n        </div>\n    </div>\n'})}},t={};function s(n){if(t[n])return t[n].exports;var a=t[n]={exports:{}};return e[n](a,a.exports,s),a.exports}return s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s(154)})();
//# sourceMappingURL=frontend.js.map